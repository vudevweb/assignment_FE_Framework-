<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="/assets/framework/angulerJS/angular.min.js"></script>

</head>
<body>
    <div ng-app="app" class="mt-3">
        <div ng-controller="my-ctrl-1">
            <div class="w-25 mx-auto">
                <div class="mb-3">
                    <label for="fullname" class="form-label">Họ và tên</label>
                    <input ng-model="student.fullname" id="fullname" type="text" class="form-control" placeholder="Họ và tên">
                    <span class="text-danger fs-6" ng-bind="fullnameError"></span>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Ngày sinh</label>
                    <input ng-model="student.birthday" id="dob" type="text" placeholder="Birthday" class="form-control">
                    <span class="text-danger fs-6" ng-bind="birthdayError"></span>
                </div>
                <div class="mb-3">
                    <label for="point" class="form-label">Điểm</label>
                    <input ng-model="student.mark" id="point" type="number" class="form-control" placeholder="Điểm">
                    <span class="text-danger fs-6" ng-bind="markError"></span>
                </div>
                <div class="form-group">
                    <button ng-if="checkIndex == -1" class="btn btn-outline-success" ng-click="create()" type="">Thêm</button>
                    <button ng-if="checkIndex != -1" class="btn btn-outline-success" ng-click="update()" type="">Sửa</button>
                    <button class="btn btn-outline-danger" ng-click="cancel()" type="">Hủy</button>
                    <button class="btn btn-outline-success" ng-click="clear()" type="">Mới</button>
                </div>
            </div>
        </div>
        <div ng-controller="my-ctrl-2">
            <table class="table w-50 mx-auto mt-5">
                <thead>
                    <tr>
                        <th>Họ và tên</th>
                        <th>Ngày sinh</th>
                        <th>Điểm</th>
                        <th>Xếp loại</th>
                        <th>action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="(index, row) in students">
                        <td>{{ row.fullname }}</td>
                        <td>{{ row.birthday }}</td>
                        <td>{{ row.mark }}</td>
                        <td>
                            <span ng-if="row.mark < 5">Yếu / Kém</span>
                            <span ng-if="row.mark >= 5 && row.mark < 8">Trung bình/ Khá</span>
                            <span ng-if="row.mark >= 8">Giỏi / Xuất sắc</span>
                        </td>
                        <td>
                            <button class="btn btn-warning" ng-click="edit(row)">Sửa</button>
                            <button class="btn btn-outline-success" ng-click="delete(index)" type="">Xóa</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        const app = angular.module('app', []);
        app.controller('my-ctrl-1', ($scope, $rootScope) => {
            $rootScope.student = {};
            $rootScope.checkIndex = -1;
            $scope.isCheck = true;
            $rootScope.node = 'create';

            $scope.create = () => {
                $scope.fullnameError = '';
                $scope.birthdayError = '';
                $scope.markError = '';
                if (!$scope.student.fullname) {
                    $scope.fullnameError = 'Không được để trống trường tên';
                    $scope.isCheck = false;
                }
    
                if (!$scope.student.birthday) {
                    $scope.birthdayError = 'Không được để trống trường ngày sinh';
                    $scope.isCheck = false;
                }
    
                if (!$scope.student.mark) {
                    $scope.markError = 'Không được để trống trường điểm';
                    $scope.isCheck = false;
                } else if ($scope.student.mark < 0) {
                    $scope.markError = 'Điểm không được nhỏ hơn 0';
                    $scope.isCheck = false;
                } else if ($scope.student.mark > 10) {
                    $scope.markError = 'Điểm không được lớn hơn 10';
                    $scope.isCheck = false;
                }
    
                if ($scope.isCheck == true) {
                    $scope.students.push($scope.student);
                    $rootScope.student = {};
                }
            };

            $scope.update = () => {
                $scope.fullnameError = '';
                $scope.birthdayError = '';
                $scope.markError = '';
                if (!$scope.student.fullname) {
                    $scope.fullnameError = 'Không được để trống trường tên';
                    $scope.isCheck = false;
                }
    
                if (!$scope.student.birthday) {
                    $scope.birthdayError = 'Không được để trống trường ngày sinh';
                    $scope.isCheck = false;
                }
    
                if (!$scope.student.mark) {
                    $scope.markError = 'Không được để trống trường điểm';
                    $scope.isCheck = false;
                } else if ($scope.student.mark < 0) {
                    $scope.markError = 'Điểm không được nhỏ hơn 0';
                    $scope.isCheck = false;
                } else if ($scope.student.mark > 10) {
                    $scope.markError = 'Điểm không được lớn hơn 10';
                    $scope.isCheck = false;
                }
    
                if ($scope.isCheck == true) {
                    const index = $scope.students.findIndex(item => item.fullname === $scope.student.fullname);
                    if (index !== -1) {
                        $scope.students[index] = angular.copy($scope.student);
                    }
                    $rootScope.student = {};
                    $rootScope.checkIndex = -1;
                }
            };

            $scope.cancel = () => {
                if ($rootScope.checkIndex === -1) {
                    $scope.student = {}; 
                } else if ($rootScope.checkIndex === 1) {
                    $scope.student = angular.copy($rootScope.student);
                }
            };

            $scope.clear = () => {
                $scope.student = {};
                $rootScope.checkIndex = -1
            }

        });
    
        app.controller('my-ctrl-2', ($scope, $rootScope) => {
            $scope.editingStudent = null;
            $rootScope.students = [
                {
                    fullname: 'Nguyễn B',
                    birthday: '3/5/2004',
                    mark: 9
                },
                {
                    fullname: 'Nguyễn C',
                    birthday: '3/5/2004',
                    mark: 9
                }
            ];

            $scope.edit = (student) => {
                $rootScope.student = angular.copy(student);
                $rootScope.checkIndex = 1;
            }

            $scope.delete = (index) => {
                let a = confirm('Bạn có chắc muốn xóa không');
                if (a) {
                    $scope.students.splice(index, 1);
                }
            };
        });  

    </script>
</body>
</html>